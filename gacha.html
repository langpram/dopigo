<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dopigo Memory Challenge - Menangkan Diskon!</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #fff8e7 0%, #ffe4c4 100%);
        min-height: 100vh;
        display: flex;
        /* Hapus justify-content: center; dan align-items: center; agar konten game tidak terpusat di tengah layar vertikal */
        flex-direction: column;
        padding: 0; /* Hapus padding body agar navbar menempel */
        position: relative;
        overflow-x: hidden;
        scroll-behavior: smooth;
      }
      /* Animated Background Elements */
      .bg-decoration {
        position: fixed;
        opacity: 0.1;
        pointer-events: none;
        animation: float 20s ease-in-out infinite;
      }
      .bg-decoration:nth-child(1) {
        top: 10%;
        left: 5%;
        font-size: 100px;
        animation-duration: 15s;
      }
      .bg-decoration:nth-child(2) {
        top: 70%;
        right: 10%;
        font-size: 80px;
        animation-delay: 5s;
      }
      .bg-decoration:nth-child(3) {
        top: 40%;
        left: 80%;
        font-size: 120px;
        animation-duration: 25s;
        animation-delay: 10s;
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        25% {
          transform: translateY(-30px) rotate(10deg);
        }
        50% {
          transform: translateY(20px) rotate(-5deg);
        }
        75% {
          transform: translateY(-20px) rotate(5deg);
        }
      }
      .container {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto; /* Tambahkan margin auto agar konten di tengah */
        position: relative;
        z-index: 10;
        padding: 0 20px 40px 20px;
        flex-grow: 1; /* Pastikan container mengisi sisa ruang */
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      /* --- NAVBAR (Copied from index.html) --- */
      .navbar {
        width: 100%;
        position: sticky;
        height: 70px;
        top: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .nav-content {
        max-width: 1200px;
        height: 70px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
      }
      .nav-logo-img {
        height: 50px;
        width: auto;
      }
      .nav-links {
        list-style: none;
        display: flex;
        gap: 25px;
      }
      .nav-links a {
        text-decoration: none;
        color: #8b4513;
        font-weight: 600;
        font-size: 1em;
        padding: 5px 10px;
        border-radius: 8px;
        transition: background 0.3s ease;
      }
      .nav-links a:hover {
        background: #ffe4c4;
        color: #d2691e;
      }
      /* Offset for sections to prevent content from being hidden under navbar */
      .section-target {
        margin-top: -70px;
        padding-top: 90px;
      }
      /* Game header section doesn't need offset */
      #game-header {
        margin-top: 20px;
        padding-top: 0;
      }
      .game-header {
        background: white;
        padding: 30px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        width: 100%; /* Pastikan header selebar container */
        border-radius: 25px 25px 0 0; /* Tambah radius agar terlihat bagus dengan board */
      }
      .game-header h1 {
        color: #8b4513;
        font-size: 2.2em;
        font-weight: 800;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }
      .game-header p {
        color: #d2691e;
        font-size: 1.2em;
        font-weight: 600;
      }
      .tagline {
        color: #ff6f00;
        font-style: italic;
        font-size: 1em;
        margin-top: 5px;
      }
      .game-info {
        background: linear-gradient(135deg, #d2691e 0%, #8b4513 100%);
        padding: 25px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        width: 100%; /* Pastikan info selebar container */
      }
      .info-box {
        background: rgba(255, 255, 255, 0.95);
        padding: 15px 30px;
        border-radius: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        text-align: center;
        min-width: 140px;
        transition: transform 0.3s ease;
      }
      .info-box:hover {
        transform: translateY(-3px) scale(1.05);
      }
      .info-label {
        color: #8b4513;
        font-size: 0.9em;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .info-value {
        color: #d2691e;
        font-size: 2em;
        font-weight: 800;
      }
      #timer {
        color: #ff4444;
        animation: pulse 1s ease-in-out infinite;
      }
      #timer.warning {
        animation: warningPulse 0.5s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      @keyframes warningPulse {
        0%,
        100% {
          transform: scale(1);
          color: #ff0000;
        }
        50% {
          transform: scale(1.1);
          color: #ff6666;
        }
      }
      .game-board {
        background: white;
        border-radius: 0 0 25px 25px;
        padding: 40px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        position: relative;
        width: 100%; /* Pastikan board selebar container */
      }
      /* Mascot Container */
      .mascot-container {
        position: absolute;
        top: -80px;
        right: 20px;
        z-index: 100;
      }
      .mascot {
        width: 120px;
        height: 120px;
        object-fit: contain;
        filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.3));
        transition: all 0.5s ease;
      }
      .mascot.happy {
        animation: happyBounce 1s ease;
      }
      .mascot.sad {
        animation: sadShake 0.5s ease;
        transform: rotate(-10deg);
      }
      .mascot.excited {
        animation: excitedSpin 1s ease;
      }
      @keyframes happyBounce {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        25% {
          transform: translateY(-20px) rotate(10deg);
        }
        50% {
          transform: translateY(-30px) rotate(-10deg);
        }
        75% {
          transform: translateY(-15px) rotate(5deg);
        }
      }
      @keyframes sadShake {
        0%,
        100% {
          transform: translateX(0) rotate(-10deg);
        }
        25% {
          transform: translateX(-10px) rotate(-15deg);
        }
        50% {
          transform: translateX(10px) rotate(-5deg);
        }
        75% {
          transform: translateX(-5px) rotate(-12deg);
        }
      }
      @keyframes excitedSpin {
        0% {
          transform: rotate(0deg) scale(1);
        }
        50% {
          transform: rotate(360deg) scale(1.2);
        }
        100% {
          transform: rotate(720deg) scale(1);
        }
      }
      .speech-bubble {
        position: absolute;
        top: -40px;
        left: -150px;
        background: white;
        border: 3px solid #d2691e;
        border-radius: 20px;
        padding: 10px 15px;
        font-size: 0.9em;
        font-weight: 600;
        color: #8b4513;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        white-space: nowrap;
      }
      .speech-bubble.show {
        opacity: 1;
        transform: scale(1);
      }
      .speech-bubble::after {
        content: "";
        position: absolute;
        right: -10px;
        top: 50%;
        transform: translateY(-50%);
        border-left: 10px solid #d2691e;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
      }
      .cards-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 25px;
        position: relative;
      }
      .card {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #ffe4c4 0%, #ffdab9 100%);
        border-radius: 20px;
        cursor: pointer;
        position: relative;
        transform-style: preserve-3d;
        transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .card:hover:not(.flipped):not(.matched) {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 12px 30px rgba(139, 69, 19, 0.3);
      }
      .card.flipped {
        transform: rotateY(180deg);
      }
      .card.matched {
        animation: matchCelebration 0.8s ease;
        pointer-events: none;
      }
      @keyframes matchCelebration {
        0% {
          transform: scale(1) rotateY(180deg);
        }
        25% {
          transform: scale(1.2) rotateY(180deg) rotate(10deg);
        }
        50% {
          transform: scale(1.1) rotateY(180deg) rotate(-10deg);
        }
        75% {
          transform: scale(1.15) rotateY(180deg) rotate(5deg);
        }
        100% {
          transform: scale(1) rotateY(180deg) rotate(0deg);
        }
      }
      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 20px;
        backface-visibility: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 3em;
      }
      .card-front {
        background: linear-gradient(135deg, #d2691e 0%, #8b4513 100%);
        color: white;
        font-weight: 800;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
      }
      .card-back {
        background: linear-gradient(135deg, #ffffff 0%, #fff8e7 100%);
        transform: rotateY(180deg);
        border: 4px solid #ff9900;
        box-shadow: inset 0 0 15px rgba(255, 153, 0, 0.2);
      }
      
      /* --- START SCREEN ENHANCEMENTS (Tampilan Awal Diperbagus) --- */
      .start-screen,
      .result-screen {
        text-align: center;
        padding: 50px 30px; /* Diperbarui */
      }
      .start-screen h2 {
        color: #8b4513;
        font-size: 3em; /* Diperbesar */
        font-weight: 800;
        margin-bottom: 10px; /* Diperbarui */
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }
      .start-screen p {
        color: #6b4423;
        font-size: 1.2em; /* Diperbesar */
        margin-bottom: 30px; /* Diperbarui */
        line-height: 1.8;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
      
      .start-layout {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* Tata letak 2 kolom */
        gap: 30px;
        margin-top: 30px;
        margin-bottom: 40px;
        text-align: left;
      }
      /* Mengganti gaya .rules dan .prize-tiers agar terlihat seperti panel */
      .rules {
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 20px;
        border-left: 6px solid #ff9900;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .rules:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }
      .rules h3 {
        color: #8b4513;
        font-size: 1.6em; /* Diperbesar */
        margin-bottom: 15px;
        font-weight: 700;
      }
      .rules ul {
        text-align: left;
        color: #6b4423;
        line-height: 2.2;
        list-style: none;
        padding-left: 0;
      }
      
      .prize-tiers {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        padding: 30px; /* Diperbarui */
        border-left: 6px solid #d2691e; /* Warna border berbeda */
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .prize-tiers:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }
      .prize-tiers h3 {
        color: #8b4513;
        font-size: 1.6em; /* Diperbesar */
        margin-bottom: 15px;
        font-weight: 700;
        text-align: center;
      }
      
      /* Gaya Button tetap sama */
      .btn {
        background: linear-gradient(135deg, #ff9900 0%, #ff6f00 100%);
        color: white;
        border: none;
        padding: 18px 50px;
        font-size: 1.3em;
        font-weight: 700;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(255, 111, 0, 0.4);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }
      .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      .btn:hover::before {
        width: 300px;
        height: 300px;
      }
      .btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 40px rgba(255, 111, 0, 0.6);
      }
      .btn:active {
        transform: translateY(-2px) scale(1.02);
      }
      
      .prize-display {
        background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
        padding: 35px;
        border-radius: 25px;
        margin: 30px 0;
        box-shadow: 0 15px 40px rgba(255, 215, 0, 0.5);
        animation: prizeShine 3s ease-in-out infinite;
        position: relative;
        overflow: hidden;
      }
      .prize-display::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transform: rotate(45deg);
        animation: shimmer 3s infinite;
      }
      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }
      @keyframes prizeShine {
        0%,
        100% {
          box-shadow: 0 15px 40px rgba(255, 215, 0, 0.5);
          transform: scale(1);
        }
        50% {
          box-shadow: 0 20px 60px rgba(255, 215, 0, 0.8);
          transform: scale(1.02);
        }
      }
      .prize-display h3 {
        color: #5d4037;
        font-size: 3em;
        font-weight: 800;
        margin-bottom: 15px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1;
      }
      .prize-display p {
        color: #8b4513;
        font-size: 1.4em;
        font-weight: 600;
        position: relative;
        z-index: 1;
      }
      .hidden {
        display: none;
      }
      
      /* Gaya daftar rules diperjelas */
      .rules li {
        padding-left: 35px;
        position: relative;
        margin-bottom: 10px;
        font-weight: 500;
      }
      
      .rules li::before {
        content: attr(data-emoji);
        position: absolute;
        left: 0;
        font-size: 1.3em;
      }
      
      /* Gaya Prize Tier diperjelas */
      .prize-tier {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        margin: 8px 0;
        background: linear-gradient(135deg, #fff8e7 0%, #ffe4c4 100%);
        border-radius: 15px;
        border-left: 5px solid;
        transition: transform 0.3s ease;
      }
      .prize-tier:hover {
        transform: translateX(5px);
      }
      .prize-tier.gold {
        border-left-color: #ffd700;
        box-shadow: 0 3px 10px rgba(255, 215, 0, 0.2);
      }
      .prize-tier.silver {
        border-left-color: #c0c0c0;
        box-shadow: 0 3px 10px rgba(192, 192, 192, 0.2);
      }
      .prize-tier.bronze {
        border-left-color: #cd7f32;
        box-shadow: 0 3px 10px rgba(205, 127, 50, 0.2);
      }
      .prize-tier.normal {
        border-left-color: #8b4513;
        box-shadow: 0 3px 10px rgba(139, 69, 19, 0.1);
      }
      
      .stats-display {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
      }
      .stat-item {
        text-align: center;
        padding: 15px;
        background: rgba(255, 248, 220, 0.8);
        border-radius: 15px;
        min-width: 120px;
      }
      .stat-label {
        color: #8b4513;
        font-size: 0.9em;
        margin-bottom: 5px;
      }
      .stat-value {
        color: #d2691e;
        font-size: 2em;
        font-weight: 800;
      }
      
      /* Responsive Fixes */
      @media (max-width: 992px) {
          .start-layout {
            grid-template-columns: 1fr; /* Stack Rules and Prize Tiers on smaller desktop/tablet */
          }
      }
      @media (max-width: 768px) {
        .nav-links {
          display: none; /* Hide nav links on mobile */
        }
        .nav-content {
          justify-content: center;
          padding: 0 20px;
        }
        .nav-logo-img {
          height: 60px;
          width: auto;
        }
        .cards-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 10px;
        }
        .game-header h1 {
          font-size: 1.8em;
        }
        .card-face {
          font-size: 2.2em;
        }
        .mascot-container {
          top: -60px;
          right: 10px;
        }
        .mascot {
          width: 80px;
          height: 80px;
        }
        .speech-bubble {
          left: -120px;
          font-size: 0.8em;
        }
        /* Mobile Start Screen Adjustment */
        .start-screen h2 {
            font-size: 2.5em;
        }
        .rules, .prize-tiers {
            padding: 20px;
        }
      }
      @media (max-width: 480px) {
        .cards-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 8px;
        }
        .card-face {
          font-size: 1.8em;
        }
        .info-box {
          min-width: 100px;
          padding: 10px 15px;
        }
        .info-value {
          font-size: 1.5em;
        }
        .start-screen h2 {
            font-size: 2em;
        }
        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-decoration">‚òï</div>
    <div class="bg-decoration">üç©</div>
    <div class="bg-decoration">üßã</div>

    <nav class="navbar">
      <div class="nav-content">
        <a href="index.html">
          <img src="asset/dopigo_logo_final.png" alt="Dopigo Logo" class="nav-logo-img" />
        </a>
        <ul class="nav-links">
          <li><a href="index.html">Beranda</a></li>
          <li><a href="gacha.html">Game</a></li>
        </ul>
      </div>
    </nav>
    
    <div class="container">
      <div class="section-target" id="game-header"></div>
      <div class="game-header">
        <h1>DOPIGO MEMORY CHALLENGE</h1>
        <p>Ayo bermain untuk memenangkan diskon spesial!</p>
        <p class="tagline">Affordable Treats, Premium Feels!</p>
      </div>
      
      <div class="game-info hidden" id="game-info">
        <div class="info-box">
          <div class="info-label">‚è±Ô∏è Waktu</div>
          <div class="info-value" id="timer">45</div>
        </div>
        <div class="info-box">
          <div class="info-label">üëÜ Langkah</div>
          <div class="info-value" id="moves">0</div>
        </div>
        <div class="info-box">
          <div class="info-label">‚≠ê Skor</div>
          <div class="info-value" id="score">0</div>
        </div>
      </div>

      <div class="game-board">
        <div class="mascot-container">
            <img 
                src="asset/game-mascot.png" 
                alt="Dopigo Mascot" 
                class="mascot" 
                id="mascot"
            />
            <div class="speech-bubble" id="speechBubble">Siap-siap, ya!</div>
        </div>

        <div class="start-screen" id="startScreen">
          <h2>SIAP UNTUK DOPIGO CHALLENGE?</h2>
          <p>
            Uji daya ingatmu dengan memecahkan tantangan kartu memori dalam waktu terbatas dan menangkan **DISCOUNT SPESIAL** hingga **25%** untuk pesananmu!
          </p>

          <button class="btn" onclick="startGame()">
            Mulai Tantangan!
          </button>
          
          <div class="start-layout">
            <div class="rules">
              <h3>üìù Cara Bermain</h3>
              <ul>
                <li data-emoji="üß†">Cari pasangan kartu yang sama.</li>
                <li data-emoji="‚è±Ô∏è">Waktu hanya **45 detik**.</li>
                <li data-emoji="üö´">Kesempatan membuka kartu salah terbatas (tergantung level).</li>
                <li data-emoji="‚úÖ">Selesaikan semua pasangan untuk menang!</li>
              </ul>
            </div>

            <div class="prize-tiers">
              <h3>üèÜ Hadiah Menarik</h3>
              <div class="prize-tier gold">
                <span>ü•á Sempurna (&lt; 15 Langkah)</span>
                <span>Diskon 25%</span>
              </div>
              <div class="prize-tier silver">
                <span>ü•à Bagus (&lt; 20 Langkah)</span>
                <span>Diskon 15%</span>
              </div>
              <div class="prize-tier bronze">
                <span>ü•â Cukup Baik (&lt; 25 Langkah)</span>
                <span>Diskon 10%</span>
              </div>
              <div class="prize-tier normal">
                <span>üéØ Coba Lagi</span>
                <span>Semangat!</span>
              </div>
            </div>
          </div>
        </div>

        <div class="cards-grid hidden" id="cardsGrid">
          </div>

        <div class="result-screen hidden" id="resultScreen">
          <div class="prize-display">
            <h3 id="prizeTitle">üéâ SELAMAT! ANDA MENANG! üéâ</h3>
            <p id="prizeDesc">
              Anda berhasil menyelesaikan challenge dalam waktu X detik dan Y langkah. Tunjukkan kode ini di kasir untuk klaim hadiah Anda!
            </p>
          </div>
          <div class="stats-display">
            <div class="stat-item">
              <div class="stat-label">Total Waktu</div>
              <div class="stat-value" id="finalTime">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Total Langkah</div>
              <div class="stat-value" id="finalMoves">--</div>
            </div>
          </div>
          <button class="btn" onclick="resetGame()">Main Lagi!</button>
          <p class="rules" style="margin-top: 30px; font-size: 0.9em;">*Diskon berlaku untuk pembelian minimum Rp. 20.000 dan tidak dapat digabungkan dengan promo lainnya.</p>
        </div>
      </div>
    </div>
    
    <script>
      // Asset list for the cards
      const cardAssets = [
        "‚òï",
        "üç©",
        "üßã",
        "ü•ê",
        "ü•™",
        "üç∞",
        "üçÆ",
        "üçé",
      ];
      const gameInfoEl = document.getElementById("game-info");
      const cardsGridEl = document.getElementById("cardsGrid");
      const startScreenEl = document.getElementById("startScreen");
      const resultScreenEl = document.getElementById("resultScreen");
      const timerEl = document.getElementById("timer");
      const movesEl = document.getElementById("moves");
      const scoreEl = document.getElementById("score");
      const mascot = document.getElementById("mascot");
      const speechBubble = document.getElementById("speechBubble");
      
      let cards = [];
      let flippedCards = [];
      let matchedPairs = 0;
      let totalMoves = 0;
      let score = 0;
      let timer;
      let timeLeft =45;
      let isGameActive = false;

      function shuffle(array) {
        let currentIndex = array.length,
          randomIndex;

        while (currentIndex != 0) {
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex--;

          [array[currentIndex], array[randomIndex]] = [
            array[randomIndex],
            array[currentIndex],
          ];
        }

        return array;
      }

      function generateCards() {
        // Create an array with two of each asset
        const gameCards = [...cardAssets, ...cardAssets];
        shuffle(gameCards);

        cardsGridEl.innerHTML = "";
        cards = [];

        gameCards.forEach((asset, index) => {
          const cardEl = document.createElement("div");
          cardEl.classList.add("card");
          cardEl.dataset.asset = asset;
          cardEl.dataset.index = index;
          cardEl.onclick = () => flipCard(cardEl);

          const frontFace = document.createElement("div");
          frontFace.classList.add("card-face", "card-front");
          frontFace.textContent = "?"; // Placeholder for the back of the card

          const backFace = document.createElement("div");
          backFace.classList.add("card-face", "card-back");
          backFace.textContent = asset;

          cardEl.appendChild(frontFace);
          cardEl.appendChild(backFace);
          cardsGridEl.appendChild(cardEl);
          cards.push(cardEl);
        });
      }

      function updateGameStats() {
        movesEl.textContent = totalMoves;
        scoreEl.textContent = score;
        timerEl.textContent = timeLeft;

        if (timeLeft <= 10) {
          timerEl.classList.add("warning");
        } else {
          timerEl.classList.remove("warning");
        }
      }

      function showMascotReaction(type, emotion) {
        mascot.classList.remove("happy", "sad", "excited");
        
        // Remove old animation classes from mascot
        mascot.style.animation = "none";
        mascot.offsetHeight; /* trigger reflow */
        mascot.style.animation = null;
        
        speechBubble.classList.remove("show");

        let text = "";
        let duration = 1500; // default duration

        if (type === "start") {
            text = "Yukk, mulai! Semangat, ya!";
            mascot.classList.add("excited");
        } else if (type === "match") {
          text = ["KEREN!", "Cepat sekali!", "GO GO GO!"][
            Math.floor(Math.random() * 3)
          ];
          mascot.classList.add("happy");
          duration = 1000;
        } else if (type === "miss") {
          text = ["Duh, salah!", "Fokus lagi!", "Ayo coba lagi!"][
            Math.floor(Math.random() * 3)
          ];
          mascot.classList.add("sad");
          duration = 1000;
        } else if (type === "win") {
          if (emotion === "excited") {
             text = "Gila! Juara kamu!";
          } else if (emotion === "happy") {
             text = "Hehe, mantap nih diskonnya!";
          } else {
             text = "Luar biasa! Terima kasih sudah main!";
          }
          
        } else if (type === "lose") {
          text = "Waktu habis, sayang sekali... coba lagi ya!";
          mascot.classList.add("sad");
        }
        
        if (text) {
          speechBubble.textContent = text;
          speechBubble.classList.add("show");
          setTimeout(() => {
            speechBubble.classList.remove("show");
          }, duration);
        }
      }

      function flipCard(cardEl) {
        if (!isGameActive || flippedCards.length === 2 || cardEl.classList.contains("flipped")) {
          return;
        }

        cardEl.classList.add("flipped");
        flippedCards.push(cardEl);

        if (flippedCards.length === 2) {
          totalMoves++;
          updateGameStats();
          checkForMatch();
        }
      }

      function checkForMatch() {
        const [card1, card2] = flippedCards;
        const isMatch = card1.dataset.asset === card2.dataset.asset;

        if (isMatch) {
          // It's a match!
          matchedPairs++;
          score += 100;
          card1.classList.add("matched");
          card2.classList.add("matched");
          showMascotReaction("match");
          flippedCards = [];

          if (matchedPairs === cardAssets.length) {
            // Game Won!
            endGame(true);
          }
        } else {
          // No match, flip back after a delay
          showMascotReaction("miss");
          setTimeout(() => {
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
            flippedCards = [];
          }, 1000);
        }
      }

      function countdown() {
        if (!isGameActive) return;

        timeLeft--;
        updateGameStats();

        if (timeLeft <= 0) {
          clearInterval(timer);
          endGame(false);
        } else {
          timer = setTimeout(countdown, 1000);
        }
      }

      function startGame() {
        // Reset all state
        matchedPairs = 0;
        totalMoves = 0;
        score = 0;
        timeLeft = 45;
        isGameActive = true;
        
        // Clear previous timer if any
        if (timer) clearInterval(timer);

        // UI updates
        startScreenEl.classList.add("hidden");
        cardsGridEl.classList.remove("hidden");
        gameInfoEl.classList.remove("hidden");
        updateGameStats();
        
        // Start Game Logic
        generateCards();
        countdown();
        showMascotReaction("start");
      }

      function endGame(isWin) {
        isGameActive = false;
        if (timer) clearInterval(timer);

        cardsGridEl.classList.add("hidden");
        gameInfoEl.classList.add("hidden");
        resultScreenEl.classList.remove("hidden");

        document.getElementById("finalTime").textContent = `${45 - timeLeft} detik`;
        document.getElementById("finalMoves").textContent = `${totalMoves} langkah`;
        
        let prize = "";
        let prizeDesc = "";
        let emotion = "normal"; // Default emotion

        if (isWin) {
          // Determine prize based on totalMoves
          if (totalMoves <= 15) {
            prize = "üéâ GRAND PRIZE! DISKON 25% üéâ";
            prizeDesc =
              "Selamat! Anda berhasil dengan langkah SEMPURNA! Tunjukkan notifikasi ini ke staf Dopigo di kasir untuk klaim diskon 25%!";
            emotion = "excited";
          } else if (totalMoves <= 20) {
            prize = "ü•≥ SELAMAT! DISKON 15% ü•≥";
            prizeDesc =
              "Hebat! Anda berhasil menyelesaikan tantangan. Tunjukkan notifikasi ini ke staf Dopigo di kasir untuk klaim diskon 15%!";
            emotion = "happy";
          } else if (totalMoves <= 25) {
            prize = "üéÅ SELAMAT! DISKON 10% üéÅ";
            prizeDesc =
              "Bagus! Anda menang. Tunjukkan notifikasi ini ke staf Dopigo di kasir untuk klaim diskon 10%!";
            emotion = "happy";
          } else {
            prize = "‚≠ê SELAMAT! DISKON 5% ‚≠ê";
            prizeDesc = "Anda menang! Tunjukkan notifikasi ini ke staf Dopigo di kasir!";
            emotion = "normal";
          }
          showMascotReaction("win", emotion);
        } else {
          prize = "üéØ COBA LAGI YUK! üéØ";
          prizeDesc =
            "Waktunya habis! Tapi jangan sedih, main lagi untuk kesempatan menang diskon! Fighting! üí™";
          showMascotReaction("lose", "sad");
          emotion = "sad";
        }
        
        document.getElementById("prizeTitle").textContent = prize;
        document.getElementById("prizeDesc").textContent = prizeDesc;
        
        // Show mascot final reaction
        setTimeout(() => {
          const mascot = document.getElementById("mascot");
          if (emotion === "excited") mascot.classList.add("excited");
          else if (emotion === "happy") mascot.classList.add("happy");
          else if (emotion === "sad") mascot.classList.add("sad");
        }, 500);
      }

      function resetGame() {
        document.getElementById("resultScreen").classList.add("hidden");
        document.getElementById("startScreen").classList.remove("hidden");
        // Reset mascot
        const mascot = document.getElementById("mascot");
        mascot.classList.remove("happy", "sad", "excited");
      }
      
      // Preload mascot image
      window.addEventListener("load", () => {
        const img = new Image();
        img.src =
          "https://res.cloudinary.com/doepilwju/image/upload/v1759737908/dopigo_mascot_o4j2g0.png";
      });
    </script>
  </body>
</html>